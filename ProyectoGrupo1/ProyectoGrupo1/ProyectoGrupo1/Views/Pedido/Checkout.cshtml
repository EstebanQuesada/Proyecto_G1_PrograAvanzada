@model ProyectoGrupo1.Models.Carrito
@{
    ViewData["Title"] = "Confirmar pedido";
    var tieneItems = Model?.Detalles != null && Model.Detalles.Count > 0;
    var total = tieneItems ? Model.Detalles.Sum(x => x.Subtotal) : 0m;
}

<div class="page-header mb-3">
    <h2 class="page-title">Confirmar pedido</h2>
    <a asp-controller="Carrito" asp-action="Index" class="btn btn-ghost">Volver al carrito</a>
</div>

@if (!tieneItems)
{
    <div class="empty-state">Tu carrito está vacío.</div>
}
else
{
    <div class="table-wrap mb-3">
        <div class="table-responsive">
            <table class="table table-modern table-hover align-middle">
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th style="width:120px">Talla</th>
                        <th style="width:120px">Color</th>
                        <th class="text-end" style="width:100px">Cant.</th>
                        <th class="text-end" style="width:140px">P. Unit</th>
                        <th class="text-end" style="width:160px">Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var d in Model.Detalles)
                    {
                        <tr>
                            <td class="fw-semibold">@d.NombreProducto</td>
                            <td>@d.NombreTalla</td>
                            <td>@d.NombreColor</td>
                            <td class="text-end">@d.Cantidad</td>
                            <td class="text-end">@d.PrecioUnitario.ToString("C")</td>
                            <td class="text-end">@d.Subtotal.ToString("C")</td>
                        </tr>
                    }
                </tbody>
                <tfoot>
                    <tr>
                        <th colspan="5" class="text-end">Total</th>
                        <th class="text-end">@total.ToString("C")</th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <form id="frmConfirmar" asp-action="Confirmar" method="post" class="d-grid d-sm-flex gap-2">
        @Html.AntiForgeryToken()
        <a asp-controller="Carrito" asp-action="Index" class="btn btn-ghost">Volver al carrito</a>
        <button id="btnConfirmar" type="submit" class="btn btn-main">
            Confirmar pedido
        </button>
    </form>

    @section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', () => {
          const form = document.getElementById('frmConfirmar');
          const btn  = document.getElementById('btnConfirmar');
          if (!form || !btn) return;

          form.addEventListener('submit', () => {
            btn.disabled = true;

            btn.textContent = 'Confirmando...';
          });
          document.addEventListener('invalid', () => {
            btn.disabled = false;
            btn.textContent = 'Confirmar pedido';
          }, true);
        });
    </script>
    }
}

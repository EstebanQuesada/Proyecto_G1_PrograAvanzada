@using Microsoft.AspNetCore.Http
@using ProyectoGrupo1
@{
    var rol = ViewContext.HttpContext.Session.GetInt32("RolID") ?? 0;
    var isAdmin = rol == Roles.Admin;
    var loggedIn = ViewContext.HttpContext.Session.GetInt32("UsuarioID").HasValue;
}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"] - Tienda Ropa</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/layout.css" asp-append-version="true" />
    <style>
        .header-pill {
            background: #fff;
            border-radius: 40px;
            padding: .75rem 1.25rem;
            box-shadow: 0 .5rem 1.25rem rgba(0,0,0,.06);
            display: flex;
            align-items: center;
            gap: 1rem;
            overflow: hidden
        }

        .header-brand {
            font-weight: 700;
            color: #111;
            text-decoration: none;
            margin-right: .5rem
        }

        .nav-main {
            display: flex;
            align-items: center;
            gap: 2rem;
            flex: 1 1 auto;
            min-width: 0
        }

            .nav-main .nav-link {
                color: #111;
                padding: .35rem 0;
                font-weight: 500;
                text-decoration: none
            }

                .nav-main .nav-link:hover {
                    text-decoration: underline
                }

                .nav-main .nav-link.active {
                    color: #12b9b1
                }

        .header-actions {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 1rem
        }

            .header-actions form {
                margin: 0
            }

        .btn-pill {
            background: #00d1ff;
            color: #fff;
            border: none;
            border-radius: 999px;
            padding: .5rem 1.25rem;
            box-shadow: 0 .5rem 1rem rgba(0,209,255,.25);
            line-height: 1.1;
            white-space: nowrap
        }

            .btn-pill:hover {
                filter: brightness(.95);
                color: #fff
            }

        .btn-outline-pill {
            background: #fff;
            color: #dc3545;
            border: none;
            border-radius: 999px;
            padding: .5rem 1rem;
            box-shadow: 0 .5rem 1rem rgba(0,0,0,.08);
            line-height: 1.1;
            white-space: nowrap
        }

            .btn-outline-pill:hover {
                color: #b02a37
            }
    </style>

</head>

<body>
    <header class="container py-3">
        <div class="header-pill">
            <a class="header-brand" asp-controller="Home" asp-action="Index">Tienda Ropa</a>

            <nav class="nav-main">
                @if (!(ViewContext.HttpContext.Session.GetInt32("RolID") == Roles.Admin))
                {
                    <a class="nav-link @(ViewContext.RouteData.Values["action"]?.ToString()=="Index" ? "active" : null)" asp-controller="Home" asp-action="Index">Inicio</a>
                    <a class="nav-link" asp-controller="Producto" asp-action="Catalogo">Catálogo</a>
                    <a class="nav-link" asp-controller="Carrito" asp-action="Index">Carrito</a>
                    <a class="nav-link" asp-controller="Pedido" asp-action="Historial">Historial de pedidos</a>
                    <a class="nav-link" asp-controller="Contacto" asp-action="Index">Contacto</a>
                }
                else
                {
                    <a class="nav-link" asp-controller="AdminUsuarios" asp-action="Index">Administración</a>
                    <a class="nav-link" asp-controller="AdminProducto" asp-action="Index">Productos</a>
                    <div class="dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">Catálogos</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" asp-controller="AdminCatalogos" asp-action="Categorias">Categorías</a></li>
                            <li><a class="dropdown-item" asp-controller="AdminCatalogos" asp-action="Marcas">Marcas</a></li>
                            <li><a class="dropdown-item" asp-controller="AdminCatalogos" asp-action="Tallas">Tallas</a></li>
                            <li><a class="dropdown-item" asp-controller="AdminCatalogos" asp-action="Colores">Colores</a></li>
                            <li><a class="dropdown-item" asp-controller="AdminCatalogos" asp-action="Proveedores">Proveedores</a></li>
                        </ul>
                    </div>
                    <a class="nav-link" asp-controller="AdminContacto" asp-action="Index">Mensajes</a>
                }
            </nav>

            <div class="header-actions">
                @if (ViewContext.HttpContext.Session.GetInt32("UsuarioID").HasValue)
                {
                    <a class="btn btn-pill" asp-controller="Usuario" asp-action="Perfil">Mi Perfil</a>
                    <form asp-controller="Usuario" asp-action="Logout" method="post" class="logout-form">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn-outline-pill">Cerrar sesión</button>
                    </form>
                }
                else
                {
                    <a class="nav-link" asp-controller="Usuario" asp-action="Login">Iniciar sesión</a>
                    <a class="nav-link" asp-controller="Usuario" asp-action="Register">Registrarse</a>
                }
            </div>
        </div>
    </header>

    <main class="container py-4">
        @RenderBody()
    </main>

    <footer class="bg-light text-center py-3 border-top mt-4">
        <div class="container">
            <span class="text-muted">© @DateTime.Now.Year Loop Store - Todos los derechos reservados</span>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    @RenderSection("Scripts", required: false)
</body>
</html>
